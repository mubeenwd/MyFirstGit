<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="css/jquery.mobile.flatui.css" />
    <script src="js/jquery.min.js"></script>
    <script src="js/jquery.mobile-1.3.1.min.js"></script>
    <script src="phonegap.js"></script>
    <!--<script type="text/javascript" src="js/phonegap.facebook.inappbrowser.js"></script>-->
    <script type="text/javascript" charset="utf-8">

        var my_client_id = "220567994647036", // YOUR APP ID
        my_secret = "08b47fdd154c4f9a9fc343a59eb2c514", // YOUR APP SECRET 
        my_redirect_uri = "https://www.facebook.com/connect/login_success.html", // LEAVE THIS
        my_type = "user_agent", my_display = "touch";  // LEAVE THIS

        var facebook_token = "fbToken"; // OUR TOKEN KEEPER
        var ref; //IN APP BROWSER REFERENCE

        // FACEBOOK
        var Facebook = {
            init: function () {
                // Begin Authorization
                var authorize_url = "https://www.facebook.com/dialog/oauth?";
                authorize_url += "client_id=" + my_client_id;
                authorize_url += "&redirect_uri=" + my_redirect_uri;
                authorize_url += "&display=" + my_display;
                authorize_url += "&scope=publish_stream";

                //CALL IN APP BROWSER WITH THE LINK
                ref = window.open(authorize_url, '_blank', 'location=no');

                ref.addEventListener('loadstart', function (event) {

                    Facebook.facebookLocChanged(event.url);

                });

            },
            facebookLocChanged: function (loc) {

                if (loc.indexOf("code=") >= 1) {

                    //THIS IS MEANT TO BE DONE ON SERVER SIDE TO PROTECT CLIENT SECRET
                    var codeUrl = 'https://graph.facebook.com/oauth/access_token?client_id=' + my_client_id + '&client_secret=' + my_secret + '&redirect_uri=' + my_redirect_uri + '&code=' + loc.split("=")[1];
                    console.log('CODE_URL::' + codeUrl);
                    $.ajax({
                        url: codeUrl,
                        data: {},
                        type: 'POST',
                        async: false,
                        cache: false,
                        success: function (data, status) {
                            //WE STORE THE TOKEN HERE
                            localStorage.setItem(facebook_token, data.split('=')[1].split('&')[0]);
                            facebookGetInfo(localStorage.setItem(facebook_token));
                        },
                        error: function () {
                            alert("Unknown error Occured");
                        }
                    });
                }
            },
            facebookGetInfo: function (accessToken) {
                var get_url = "https://graph.facebook.com/" + accessToken;
                $.ajax({
                    url: get_url,
                    data: {},
                    type: 'POST',
                    async: false,
                    cache: false,
                    success: function (data, status) {
                        if (data != null) {
                            if (data!=undefined) {
                                localStorage.setItem("id", data["id"]);
                                localStorage.setItem("name", data["name"]);
                                localStorage.setItem("first_name", data["first_name"]);
                                localStorage.setItem("last_name", data["last_name"]);
                                localStorage.setItem("username", data["username"]);
                                localStorage.setItem("gender", data["gender"]);
                            }
                        }
                    },
                    error: function () {
                        alert("Unknown error Occured");
                    }
                });

                //CLOSE INAPPBROWSER AND NAVIGATE TO INDEX
                ref.close();
            }
        }

        function onLoad() {
            document.addEventListener("deviceready", onDeviceReady, false);
        }

        function onDeviceReady() {
            
        }

        function openProfile() {
            $.mobile.changePage('profile.html', {
                changeHash: true,
                transition: "slide"
            });
        }

        function openBrowser() {
            Facebook.init();

            if (ref.closed) {
                $.mobile.changePage('profile.html', {
                    changeHash: true,
                    transition: "slide"
                });
            }
        }
    </script>
</head>
<body onload="onLoad()">
    <div data-role="page">
        <div data-role="panel" id="panel" data-position="right" data-theme="a" data-display="push">
        </div>
        <div data-role="header">
            <a data-iconpos="notext" data-role="button" data-icon="home" title="Home">Home</a>
            <h1>
                The Best status</h1>
            <a data-iconpos="notext" href="#panel" data-role="button" data-icon="flat-menu">
            </a>
        </div>
        <div data-role="content" role="main">
            <p>
                <div>
                    <button data-icon="flat-man" data-theme="f" onclick="openBrowser();">
                        Face Book Login</button>

                         <button data-icon="flat-man" data-theme="f" onclick="openProfile();">
                        Face Book Profile</button>
                </div>
                <div id="dvProfileContainer">
                </div>
            </p>
            <p>
                Sample text and <a href="#">links</a>.</p>
            <fieldset class="ui-grid-a">
                <div class="ui-block-a">
                    <button data-icon="flat-settings" data-theme="a">
                        Button A</button></div>
                <div class="ui-block-b">
                    <button data-icon="flat-new" data-theme="b">
                        Button B</button></div>
            </fieldset>
            <fieldset class="ui-grid-a">
                <div class="ui-block-a">
                    <button data-icon="flat-man" data-theme="c">
                        Button C</button></div>
                <div class="ui-block-b">
                    <button data-icon="flat-mail" data-theme="d">
                        Button D</button></div>
            </fieldset>
            <fieldset class="ui-grid-a">
                <div class="ui-block-a">
                    <button data-icon="flat-lock" data-theme="e">
                        Button E</button></div>
                <div class="ui-block-b">
                    <button data-icon="flat-menu" data-theme="f">
                        Button F</button></div>
            </fieldset>
            <fieldset class="ui-grid-a">
                <div class="ui-block-a">
                    <button data-icon="flat-heart" data-theme="g">
                        Button G</button></div>
            </fieldset>
            <ul data-role="listview" data-inset="true">
                <li data-role="list-divider" data-theme="a">List Header</li>
                <li>Read-only list item</li>
                <li><a href="#">Linked list item</a></li>
            </ul>
            <div data-role="collapsible-set" data-theme="b" data-content-theme="b">
                <div data-role="collapsible" data-collapsed-icon="flat-time" data-expanded-icon="flat-cross"
                    data-collapsed="false">
                    <h3>
                        Section 1</h3>
                    <p>
                        I'm the collapsible content for section 1</p>
                </div>
                <div data-role="collapsible" data-collapsed-icon="flat-calendar" data-expanded-icon="flat-cross">
                    <h3>
                        Section 2</h3>
                    <p>
                        I'm the collapsible content for section 2</p>
                </div>
                <div data-role="collapsible" data-collapsed-icon="flat-settings" data-expanded-icon="flat-cross">
                    <h3>
                        Section 3</h3>
                    <p>
                        I'm the collapsible content for section 3</p>
                </div>
            </div>
            <div data-role="fieldcontain">
                <fieldset data-role="controlgroup">
                    <input type="radio" name="radio-choice-a" data-theme="c" id="radio-choice-1-a" value="choice-1"
                        checked="checked" />
                    <label for="radio-choice-1-a">
                        Radio</label>
                    <input type="checkbox" name="checkbox-a" data-theme="c" id="checkbox-a" checked="checked" />
                    <label for="checkbox-a">
                        Checkbox</label>
                </fieldset>
            </div>
            <div data-role="fieldcontain">
                <a href="#" data-role="button" data-icon="home" data-iconpos="notext" data-theme="b"
                    data-inline="true">Home</a> <a href="#" data-role="button" data-icon="flat-video"
                        data-iconpos="notext" data-theme="b" data-inline="true">Video</a> <a href="#" data-role="button"
                            data-icon="flat-time" data-iconpos="notext" data-theme="b" data-inline="true">Time</a>
                <a href="#" data-role="button" data-icon="flat-settings" data-iconpos="notext" data-theme="b"
                    data-inline="true">Settings</a> <a href="#" data-role="button" data-icon="flat-plus"
                        data-iconpos="notext" data-theme="b" data-inline="true">Plus</a> <a href="#" data-role="button"
                            data-icon="flat-new" data-iconpos="notext" data-theme="b" data-inline="true">New</a>
                <a href="#" data-role="button" data-icon="flat-menu" data-iconpos="notext" data-theme="b"
                    data-inline="true">Menu</a> <a href="#" data-role="button" data-icon="flat-man" data-iconpos="notext"
                        data-theme="b" data-inline="true">Man</a> <a href="#" data-role="button" data-icon="flat-mail"
                            data-iconpos="notext" data-theme="b" data-inline="true">Mail</a> <a href="#" data-role="button"
                                data-icon="flat-lock" data-iconpos="notext" data-theme="b" data-inline="true">Lock</a>
                <a href="#" data-role="button" data-icon="flat-location" data-iconpos="notext" data-theme="b"
                    data-inline="true">Location</a> <a href="#" data-role="button" data-icon="flat-heart"
                        data-iconpos="notext" data-theme="b" data-inline="true">Heart</a> <a href="#" data-role="button"
                            data-icon="flat-eye" data-iconpos="notext" data-theme="b" data-inline="true">Eye</a>
                <a href="#" data-role="button" data-icon="flat-cross" data-iconpos="notext" data-theme="b"
                    data-inline="true">Cross</a> <a href="#" data-role="button" data-icon="flat-cmd"
                        data-iconpos="notext" data-theme="b" data-inline="true">Cmd</a> <a href="#" data-role="button"
                            data-icon="flat-checkround" data-iconpos="notext" data-theme="b" data-inline="true">
                            Checkround</a> <a href="#" data-role="button" data-icon="flat-calendar" data-iconpos="notext"
                                data-theme="b" data-inline="true">Calendar</a> <a href="#" data-role="button" data-icon="flat-bubble"
                                    data-iconpos="notext" data-theme="b" data-inline="true">Bubble</a>
                <a href="#" data-role="button" data-icon="flat-volume" data-iconpos="notext" data-theme="b"
                    data-inline="true">Volume</a> <a href="#" data-role="button" data-icon="flat-camera"
                        data-iconpos="notext" data-theme="b" data-inline="true">Camera</a>
            </div>
            <select name="flip-1" id="flip-1" data-theme="b" data-role="slider">
                <option value="off">Off</option>
                <option value="on" selected>On</option>
            </select>
            <div data-role="fieldcontain">
                <div data-role="controlgroup" data-type="horizontal">
                    <a href="#" data-icon="flat-mail" data-theme="a" data-iconpos="notext" data-role="button">
                        Yes</a> <a href="#" data-icon="flat-camera" data-theme="a" data-iconpos="notext"
                            data-role="button">Yes</a> <a href="#" data-icon="flat-heart" data-theme="a" data-iconpos="notext"
                                data-role="button">Yes</a> <a href="#" data-icon="flat-eye" data-theme="a" data-iconpos="notext"
                                    data-role="button">Yes</a>
                </div>
            </div>
            <div data-role="fieldcontain">
                <select name="select-choice" id="select-choice-a" data-native-menu="false" data-theme="a">
                    <option value="standard">Option 1</option>
                    <option value="rush">Option 2</option>
                    <option value="express">Option 3</option>
                    <option value="overnight">Option 4</option>
                </select>
            </div>
            <input type="text" placeholder="Text Input" />
            <div data-role="fieldcontain">
                <input type="range" name="slider" value="50" min="0" max="100" data-highlight="true" />
            </div>
        </div>
    </div>
    <div id="highlight">
    </div>
</body>
</html>
